## Прикладное использование ProbStates (понятно и по‑простому)

Ниже — как применять уровни 2–4 в задачах «из жизни». Без формул, по шагам, с короткими примерами кода.

### Как думать об уровнях
- Уровень 2 (вероятность p): обычный «шанс события». Складываем риски через OR (⊕₂).
- Уровень 3 (p-бит с знаком s): тот же шанс, но есть «знак доверия/направление» (+1 или −1).
- Уровень 4 (фаза φ): как две волны — если «в фазе», усиливают друг друга; если «в противофазе», гасят.

### Быстрые правила выбора режима ⊕₄
- Хотите «смело усилять согласованное», исследование/верхняя оценка: выберите 'quant'.
- Нужна безопасность (чтобы вероятность не «раздувалась»): 'norm'.
- Данные шумные/несогласованные — нужен компромисс: 'weight'.
- Важна матем. согласованность между уровнями 3↔4: 'opt' с Δφ=π/2.
- Особая предметная логика? задайте свою политику — 'custom'.

---

## 1) Управление рисками (страхование/комплаенс/ИТ‑инциденты)

Задача: объединить несколько факторов риска и понять, «куда дует ветер»: суммируются ли они или частично компенсируются.

Шаги (минимально достаточные):
1) Начните с уровня 2: сложите вероятности через ⊕₂.
2) Если факторы иногда «перебарщивают» или «компенсируют» друг друга — перейдите на уровень 4 и задайте фазы.
3) Выберите режим ⊕₄: для продакшена чаще 'weight' или 'norm'.

Пример — три фактора риска:

```python
from probstates import ProbabilisticBit, PhaseState, set_phase_or_mode

# L2: просто сложили риски
r1, r2, r3 = ProbabilisticBit(0.12), ProbabilisticBit(0.08), ProbabilisticBit(0.18)
print("P(any) L2:", (r1 | r2 | r3).probability)

# L4: учитываем согласованность/конфликты
set_phase_or_mode('weight')                 # компромиссно и безопасно
s1, s2, s3 = PhaseState(0.12, 0.0), PhaseState(0.08, 0.2), PhaseState(0.18, 3.1)
result = (s1 | s2) | s3                     # s3 почти в противофазе → частичная компенсация
print("P(any) L4(weight):", result.probability)
```

Памятка по рискам:
- Если источники про одно и то же событие (дубли), задайте им близкие фазы → риск не «раздуется».
- Если один источник «контрпример», задайте ему фазу около π → будет компенсация.
- Начинайте с 'weight'; если нужна жёсткая гарантия [0,1] при множестве входов — 'norm'.

---

## 2) Сенсоры/телеметрия (sensor fusion)

Задача: объединить показания датчиков, учитывая, что они могут быть согласованы/сдвинуты и шумны.

Шаги:
1) Каждое показание → `PhaseState(p, φ)`, где φ — относительный сдвиг/настройка.
2) Смоделируйте шум: `dephase(σφ)` (размывает фазу), `amp_damp(α)` (ослабляет).
3) Объедините ⊕₄ c режимом 'weight' или 'norm'.

Пример — два датчика с шумом:

```python
import numpy as np
from probstates import PhaseState, set_phase_or_mode
from probstates.coherence import dephase, amp_damp

p1, p2 = 0.6, 0.55
phi1, phi2 = 0.0, np.deg2rad(30)
s1, s2 = PhaseState(p1, phi1), PhaseState(p2, phi2)
s1 = dephase(amp_damp(s1, 0.2), sigma_phi=0.1)
s2 = dephase(amp_damp(s2, 0.2), sigma_phi=0.1)

set_phase_or_mode('weight')
fused = s1 | s2
print("P_fused ≈", round(fused.probability, 3))
```

Если гипотез много — используйте `PhaseRegister` (равномерно инициализируйте, примените оракул, `hadamard_all()`, возьмите `argmax_probability()`).

---

## 3) A/B‑анализ (простой и понятный)

Задача: понять, отличаются ли варианты A и B, и сколько данных собирать.

Шаги:
1) Посчитайте H₂(p) — это «насколько мы не уверены». Чем больше H₂, тем больше разброс.
2) Посчитайте KL(pA||pB) и KL(pB||pA) — «насколько A не похоже на B» (в обе стороны).
3) Оцените порядок выборки: если KL маленькая, нужно больше трафика; если большая — меньше.
4) Если агрегируете метрики из разных каналов — можно перейти на L4 и учесть противоречивость (фазы), выбрав 'norm'/'weight'.

Пример:

```python
from probstates.entropy import shannon_entropy, kl_divergence

pA, pB = 0.12, 0.145
print("H(A)=", round(shannon_entropy(pA),3), "H(B)=", round(shannon_entropy(pB),3))
kl = kl_divergence(pA, pB)
print("KL(A||B)=", round(kl,3))
```

Интерпретация:
- H₂ ближе к 1 → больше неопределённость (нужно больше данных для уверенного решения).
- KL ближе к 0 → A и B похожи (сложно отличить, нужен больший объём);
  KL заметно > 0 → отличие видно быстрее.

---

## 5 минут на старт (чек‑лист)
1) Если сомневаетесь — начинайте на L2. 
2) Видите дубли/конфликты источников — переходите на L4, фазы: «вместе» ≈ 0, «вразнобой» ≈ π.
3) Режим ⊕₄: продакшен — 'weight' или 'norm'; исследования — 'quant'.
4) Под шумом — используйте `dephase`, `amp_damp` и проверяйте результат.
5) Сохраняйте простоту: меньше ручных параметров — меньше ошибок.

## FAQ (частые вопросы)
- «Почему иногда вероятность меньше, чем на уровне 2?» — потому что источники могут «гасить» друг друга (противофаза) — это полезно при дублях/ошибках.
- «Как выбрать фазы?» — если нет экспертизы, начните с 0 (согласие), π (конфликт). Дальше подбирайте по валидации.
- «Какой режим лучший?» — универсального нет: для устойчивости 'weight', для строгих ограничений 'norm', для верхней оценки/исследований 'quant'.



